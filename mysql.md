### Mysql 基础
* 事务的原理, 特性, 事务并发控制
* 常用的字段, 含义和区别
* 常用数据库引擎之间的区别

事务(Transaction)
* 事务是数据库并发控制的基本单位
* 事务可以看做是一系列 SQL 语句的集合
* 事务必须要么全部执行成功, 要么全部执行(回滚)
* ACID 特性是事务的四个基本特征:
    - 原子性(Atomicity): 一个事务中所有操作全部完成或失败
    - 一致性(Consistency): 事务开始和结束之后数据完整性没有被破坏
    - 隔离性(Isolation): 允许多个事务同时对数据库修改和读写
    - 持久性(Durability): 事务结束之后, 修改是永久的不会丢失

事务的并发控制可能产生哪些问题
* 幻读(phantom read): 一个事务第二次查出现第一次没有的结果
* 非重复读(nonrepeatable read): 一个事务重复读两次得到不同的结果
* 脏读(dirty read): 一个事务读取到另一个事务没有提交的修改
* 丢失修改(lost update): 并发写入造成其中一些修改丢失

四中事务隔离级别(为了解决并发控制异常)
* 读未提交(read uncommitted): 别的事务可以读取到未提交改变
* 读已提交(read committed): 只能读取已经提交的数据
* 可重复读(repeatable read): 同一个事务先后查询结果一样(Mysql InnoDB 默认实现可重复读级别)
* 串行化(Serializable): 刷刷完全串行化的执行, 隔离级别最高, 执行效率最低

解决高并发场景下插入重复
* 使用数据库的唯一索引
* 使用队列异步写入
* 使用 redis 等实现分布式锁

乐观锁和悲观锁
* 悲观锁是先获取锁再进行操作, 一锁二查三更新 select for update
* 乐观锁先修改, 更新的时候发现数据已经变了就回滚(check and set), 乐观锁一般通过版本号或者时间戳实现
* 使需要根据响应速度, 冲突频率, 重试代价来判断使用哪一种


Mysql 常用数据类型-字符串(文本)

| 数据类型        | 长度(字节) | 说明         |
|-----------------|------------|--------------|
| VARCHAR[Length] | 0-65535    | 不定长字符串 |
| TINYTEXT        | 0-255      | 短文本字符串 |
| TEXT            | 0-65535    | 长文本数据   |

数值类型

| 数据类型          | 长度(字节) | 说明       |
|-------------------|------------|------------|
| SMALL[Length]     | 2          | 整数       |
| MEDIUMINT[Length] | 3          | 整数       |
| INT[Length]       | 4          | 整数       |
| BIGINT[Length]    | 8          | 大整数     |
| FLOAT[Length]     | 4          | 单精度浮点 |
| DOUBLE[Length]    | 8          | 双精度浮点 |

[length] length 指的是数据库至少显示 length 个字符宽

日期和时间类型

| 数据类型  | 长度(字节) | 格式                | 说明                          |
|-----------|------------|---------------------|-------------------------------|
| TIME      | 3          | HH:MM:SS            | 时间值或持续时间              |
| YEAR      | 1          | YYYY                | 年份值                        |
| DATETIME  | 8          | YYYY-MM-DD HH:MM:SS | 混合日期和时间值              |
| TIMESTAMP | 4          | YYYYMMDDHHMMSS      | 混合时间值(1970-2038), 时间戳 |

两种引擎常见区别(InnoDB vs MyISAM)
* MyISAM 不支持事务, InnoDB 支持
* MyISAM 不支持外键, InnoDB 支持
* MyISAM 只支持表锁, InnoDB 支持行锁和表锁
* MyISAM 支持全文索引, InnoDB 不支持

索引
* 普通索引(create index)
* 唯一索引, 索引列的值必须唯一(create unique index)
* 多列索引
* 主键索引(primary key), 一个表只能有一个
* 全文索引(fulltext index)

什么时候创建索引
* 经常用作查询条件的字段(where 条件)
* 经常用作表连接的字段
* 经常出现在 order by, group by 之后的字段

创建索引注意
* 非空字段 not null, Mysql 很难对空置作查询优化
* 区分度高, 离散度大, 作为索引的字段值尽量不要有大量相同值
* 索引的长度不要太长(比较耗费时间)

索引失效(模糊匹配, 类型隐转, 最左匹配)
* 以 % 开头的 LIKE 语句, 模糊搜索
* 出现隐式类型转换(在 Python 这种动态语言查询中需要注意)
* 没有满足最左前缀原则

聚集索引和非聚集索引
* 聚集还是非聚集指的是 B+ Tree 叶子节点存的是指针还是数据记录
* MyISAM 索引和数据分离, 使用的是非聚集索引
* InnoDB 数据文件就是索引文件, 主键索引就是聚集索引

排查慢查询(通常是缺少索引, 索引不合理或者业务代码实现导致)
* slow_query_log_file 开启并且查询慢查询日志
* 通过 explain 排查索引问题
* 调整数据修改索引; 业务代码层限制不合理

常用连接
* 内连接(inner join): 两个表都存在匹配时, 才会返回匹配行
    - 将左表和右表能够关联起来的数据连接后返回
    - 类似于求两个表的"交集"
    - select * from A inner join B on a.id = b.id;
* 外链接(left/right join): 返回一个表的行, 即使另一个没有匹配
    - 左连接返回左表中所有记录, 即使右表中没有匹配的记录
    - 右连接返回右表中所有记录, 即使左表中没有匹配的记录
    - 没有匹配的字段会设置成 NULL
* 全连接(full outer join): 只要某一个表存在匹配就返回
    - 只有某一个表存在匹配, 就返回行
    - 类似于求两个表的"并集"
    - 但是 Mysql 不支持, 可以用 left join, union, right join 联合使用模拟
